\NeedsTeXFormat{LaTeX2e}

\ProcessOptions\relax

% set default fonts to Times New Roman and Helvetica
\usepackage[T1]{fontenc}
\renewcommand{\rmdefault}{ptm}
\renewcommand{\sfdefault}{phv}

% set page geometry
\usepackage[
    letterpaper,
    text={6.5in,9in},
    top=1in,
    headheight=14pt,
    headsep=25pt,
    footskip=30pt,
]{geometry}

% standard typesetting voodoo
\widowpenalty=10000
\clubpenalty=10000
\sloppy

% titling reuses \@title when \maketitle clears it
\usepackage{titling}
\pretitle{
    \rule{\textwidth}{2pt}
    \begin{center}\LARGE\scshape
        \vspace{-0.2em}
        }
        \posttitle{
        \vspace{-0.2em}
    \end{center}
    \rule{\textwidth}{2pt}
    \begin{center}\normalsize\scshape A Preprint\end{center}
    \vspace{2em}
}
\preauthor{\vspace{-1em}\begin{center}\normalsize}
        \postauthor{\end{center}\vspace{-1em}}
\setlength{\droptitle}{-10ex}

% utility to remove line breaks (https://tex.stackexchange.com/a/35885)
\newcommand{\removelinebreaks}[1]{\begingroup\def\\{ }#1\endgroup}

% set running header
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead[L]{\removelinebreaks{\@title}}
\fancyhead[R]{}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0.4pt}

% set paragraph defaults
\setlength\parindent{0pt}
\setlength\parskip{0.5em}

% tightlist command for pandoc (https://github.com/jgm/pandoc-templates/blob/3430359b4c688dbedaa23d76575184191a12c4d9/default.latex#L348)
\providecommand{\tightlist}{\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% adjust section formating
\usepackage{titlesec}

\titleformat{\section}[hang]{\large\bfseries\raggedright}{\thesection}{1em}{}
\titlespacing{\section}
{0pt}
{2.0ex \@plus 0.1ex \@minus 0.1ex}
{1.5ex \@plus 0.1ex \@minus 0.1ex}

\titleformat{\subsection}[hang]{\normalsize\bfseries\raggedright}{\thesubsection}{1em}{}
\titlespacing{\subsection}
{0pt}
{1.2ex \@plus 0.1ex \@minus 0.1ex}
{1.0ex \@plus 0.1ex \@minus 0.1ex}

\titleformat{\subsubsection}[runin]{\normalsize\bfseries}{}{0pt}{}
\titlespacing{\subsubsection}
{0pt}
{1.5ex \@plus 0.5ex \@minus 0.2ex}
{1em}

% stop numbering after subsections
\setcounter{secnumdepth}{2}

% abstract styling
\renewenvironment{abstract}
{
    \vspace{-2em}
    \centerline
    {\large \bfseries \scshape Abstract}
    \begin{quote}
        }
        {
    \end{quote}
    \vspace{1.5em}
}

% figure-text spacing
\usepackage{float}
\setlength\intextsep{1.0\baselineskip \@plus 0.2\baselineskip \@minus 0.2\baselineskip}
\setlength\textfloatsep{1.7\baselineskip \@plus 0.2\baselineskip \@minus 0.5\baselineskip}